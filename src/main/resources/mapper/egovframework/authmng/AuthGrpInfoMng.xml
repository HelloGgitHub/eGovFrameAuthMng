<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.com.auth.dao.AuthGrpInfoDao">

    <select id="selectAuthGrpList" resultType="hashMap">
			SELECT A.AUTHOR_GRP_CODE
				 , A.AUTHOR_GRP_NM
				 , A.AUTHOR_GRP_DC
				 , A.AUTHOR_GRP_CREAT_DT
				 , A.CHANGE_DT
			     , ifnull((SELECT COUNT(*) CNT 
					         FROM COMTNAUTHORUSR 
					        WHERE AUTHOR_GRP_CODE = A.AUTHOR_GRP_CODE 
					        GROUP BY USR_ID),0) AS USRCNT
			     , ifnull((SELECT COUNT(*) CNT 
					         FROM COMTNAUTHORUSR 
					        WHERE AUTHOR_GRP_CODE = A.AUTHOR_GRP_CODE 
					        GROUP BY AUTHOR_GRP_CODE),0) AS ATHCNT
			  FROM COMTNAUTHORGROUPINFO A
    </select>

    
    <select id="selectAuthGrpDetail"  parameterType="Map" resultType="hashMap">
			SELECT AUTHOR_GRP_CODE
				, AUTHOR_GRP_NM
				, AUTHOR_GRP_DC
				, AUTHOR_GRP_CREAT_DT
				, CHANGE_DT
			  FROM COMTNAUTHORGROUPINFO
			 WHERE AUTHOR_GRP_CODE = '${AUTHGRPCD}'
    </select>


    <select id="selectAuthGrpInfoCnt" parameterType="Map" resultType="int">
			SELECT COUNT(*) CNT
			  FROM COMTNAUTHORGROUPINFO
			 WHERE AUTHOR_GRP_CODE = '${AUTHGRPCD}'
    </select>
    
    <insert id="insertAuthGrpInfo" parameterType="hashMap">
			INSERT INTO COMTNAUTHORGROUPINFO (
				  AUTHOR_GRP_CODE
				, AUTHOR_GRP_NM
				, AUTHOR_GRP_DC
				, AUTHOR_GRP_CREAT_DT
				, CHANGE_DT
			) VALUES (
				  #{AUTHGRPCD}
				, #{AUTHGRPNM}
				, #{AUTHGRPDC}
				, DATE_FORMAT(CURRENT_TIMESTAMP, '%Y%m%d%H%i%s')
				, DATE_FORMAT(CURRENT_TIMESTAMP, '%Y%m%d%H%i%s')
			)
    </insert>

    
    <update id="updateAuthGrpInfo" parameterType="hashMap">
			UPDATE COMTNAUTHORGROUPINFO
			   SET CHANGE_DT = DATE_FORMAT(CURRENT_TIMESTAMP, '%Y%m%d%H%i%s')
			    <if test='AUTHGRPNM != null'> 	, AUTHOR_GRP_NM	= '${AUTHGRPNM}' 	</if>
			    <if test='AUTHGRPDC != null'> 	, AUTHOR_GRP_DC	= '${AUTHGRPDC}' 	</if>
			 WHERE AUTHOR_GRP_CODE           = '${AUTHGRPCD}'
    </update>

    
    <delete id="deleteAuthGrpInfo" parameterType="hashMap">
			DELETE FROM COMTNAUTHORGROUPINFO
			 WHERE AUTHOR_GRP_CODE           = '${AUTHGRPCD}'
    </delete>
    






<!-- 권한 그룹 관리(권한)-->
    <select id="selectGrpAuthList"  parameterType="Map" resultType="hashMap">
			SELECT AUTHOR_GRP_CODE 
			     , AUTHOR_CODE 
			     , ADD_DT 
			  FROM COMTNAUTHORGROUPAUTH
			 WHERE AUTHOR_GRP_CODE  = '${AUTHGRPCD}'
    </select>


	<select id="selectGrpAuthCnt" parameterType="Map" resultType="int">
			SELECT COUNT(*) CNT
			  FROM COMTNAUTHORGROUPAUTH
			 WHERE AUTHOR_GRP_CODE  = '${AUTHGRPCD}'
			     AND AUTHOR_CODE  = '${AUTHCD}'
    </select>
    <insert id="insertGrpAuth" parameterType="hashMap">
			INSERT INTO COMTNAUTHORGROUPAUTH
				( 	  AUTHOR_GRP_CODE
					, AUTHOR_CODE 
					, ADD_DT 
				)
			SELECT A.AUTHOR_CODE 
			     , B.AUTHOR_GRP_CODE 
			     , DATE_FORMAT(CURRENT_TIMESTAMP, '%Y%m%d%H%i%s')
			  FROM COMTNAUTHORINFO a 
			     , COMTNAUTHORGROUPINFO b
			 WHERE a.AUTHOR_CODE = '${AUTHCD}'
			   AND b.AUTHOR_GRP_CODE = '${AUTHGRPCD}'
    </insert>


    <delete id="deleteGrpAuth" parameterType="hashMap">
			DELETE FROM COMTNAUTHORGROUPAUTH
			 WHERE AUTHOR_GRP_CODE           = '${AUTHGRPCD}'
			   AND AUTHOR_CODE  = '${AUTHCD}'
    </delete>
    
    
    
    
    
    
    
<!-- 권한 그룹 관리(사용자) -->
    <select id="selectGrpAuthUsrList"  parameterType="Map" resultType="hashMap">
			 SELECT USR_ID
			  FROM COMTNAUTHORUSR
			 WHERE AUTHOR_GRP_CODE =  '${AUTHGRPCD}'
			 GROUP BY USR_ID
    </select>


	<update id="updateGrpAuthUsr" parameterType="hashMap">
			UPDATE COMTNAUTHORUSR
			   SET AUTHOR_GRP_CODE = '${AUTHGRPCD}'
			     , ADD_DT = DATE_FORMAT(CURRENT_TIMESTAMP, '%Y%m%d%H%i%s')
			 WHERE USR_ID = '${USRID}'
			   AND AUTHOR_CODE IN (SELECT AUTHOR_CODE 
			                         FROM COMTNAUTHORGROUPAUTH
			                        WHERE AUTHOR_GRP_CODE  = '${AUTHGRPCD}'
			                      )
    </update>
    <insert id="insertGrpAuthUsr" parameterType="hashMap">
			INSERT INTO COMTNAUTHORUSR
			SELECT '${AUTHGRPCD}'
			     , '${USRID}'
			     , AUTHOR_CODE
			     , DATE_FORMAT(CURRENT_TIMESTAMP, '%Y%m%d%H%i%s')
			  FROM COMTNAUTHORGROUPAUTH
			 WHERE AUTHOR_CODE NOT IN (SELECT AUTHOR_CODE 
			                             FROM COMTNAUTHORUSR
			                            WHERE USR_ID  = '${USRID}'
			                          )
			   AND AUTHOR_GRP_CODE  = '${AUTHGRPCD}'
    </insert>


    <delete id="deleteGrpAuthUsr" parameterType="hashMap">
			DELETE FROM COMTNAUTHORUSR
			 WHERE AUTHOR_GRP_CODE           = '${AUTHGRPCD}'
    </delete>
    
</mapper> 