<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.com.auth.dao.AuthInfoDao">

    <select id="selectAuthList" resultType="hashMap">
			SELECT A.AUTHOR_CODE
			     , A.AUTHOR_NM
			     , A.AUTHOR_DC
			     , A.AUTHOR_CREAT_DT
			     , A.CHANGE_DT
			     , IFNULL((SELECT COUNT(*) CNT
					   	    FROM (SELECT AUTHOR_CODE 
							        FROM COMTNAUTHORUSR 
							       GROUP BY AUTHOR_CODE, USR_ID) AA
						   WHERE AA.AUTHOR_CODE = A.AUTHOR_CODE), 0) AS USRCNT
			     , IFNULL((SELECT COUNT(*) CNT 
					         FROM (SELECT AUTHOR_CODE 
			                         FROM COMTNAUTHORGROUPAUTH 
			                        GROUP BY AUTHOR_GRP_CODE, AUTHOR_CODE) BB 
					        WHERE BB.AUTHOR_CODE = A.AUTHOR_CODE),0) AS GRPCNT
			  FROM COMTNAUTHORINFO A
    </select>
    
    <select id="selectAuthDetail"  parameterType="Map" resultType="hashMap">
			SELECT AUTHOR_CODE
			     , AUTHOR_NM
			     , AUTHOR_DC
			     , AUTHOR_CREAT_DT
			     , CHANGE_DT
			  FROM COMTNAUTHORINFO
			 WHERE AUTHOR_CODE = '${AUTHCD}'
    </select>


    <select id="selectAuthInfoCnt" parameterType="Map" resultType="int">
			SELECT COUNT(*) CNT
			  FROM COMTNAUTHORINFO
			 WHERE AUTHOR_CODE = '${AUTHCD}'
    </select>
    <insert id="insertAuthInfo" parameterType="hashMap">
			INSERT INTO COMTNAUTHORINFO (
			  AUTHOR_CODE
			, AUTHOR_NM
			, AUTHOR_DC
			, AUTHOR_CREAT_DT
			, CHANGE_DT
			) VALUES (
			  #{AUTHCD}
			, #{AUTHNM}
			, #{AUTHDC}
			, #{DT}
			, #{DT}
			)
    </insert>
    
    <update id="updateAuthInfo" parameterType="hashMap">
			UPDATE COMTNAUTHORINFO
			   SET CHANGE_DT = '${DT}'
			    <if test='AUTHNM != null'> 	, AUTHOR_NM	= '${AUTHNM}' 	</if>
			    <if test='AUTHDC != null'> 	, AUTHOR_DC	= '${AUTHDC}' 	</if>
			 WHERE AUTHOR_CODE           = '${AUTHCD}'
    </update>
    
    <delete id="deleteAuthInfo" parameterType="hashMap">
			DELETE FROM COMTNAUTHORINFO
			 WHERE AUTHOR_CODE           = '${AUTHCD}'
    </delete>
    
    <delete id="deleteAuthGrp" parameterType="hashMap">
			DELETE FROM COMTNAUTHORGROUPAUTH 
			 WHERE AUTHOR_CODE           = '${AUTHCD}'
    </delete>
    
    
<!-- 로그인관련     -->
    <select id="selectUserPwCk"  parameterType="Map" resultType="hashMap">
			SELECT PASSWORD
			     , USR_ID
			  FROM COMTNUSERMNG
			 WHERE USR_ID = '${USRID}'
    </select>
    <select id="selectUserDetail"  parameterType="Map" resultType="hashMap">
		SELECT 
		        ESNTL_ID               as "uniqId",
		        'USR01'               as "userTy",
		        USR_ID               as "userId",
		        USR_NM               as "userNm",
		        USR_EMAIL_ADRES      as "emailAdres",
		        AREA_NO               as "areaNo",
		        MIDDLE_TELNO          as "middleTelno",
		        END_TELNO             as "endTelno",
		        MBTLNUM           as "moblphonNo",
		        USR_STTUS            as "sttus",
		        SBSCRB_DE             as "sbscrbDe"
		  FROM COMTNUSERMNG
		 WHERE USR_ID = '${USRID}'
    </select>
    
    
    
    
</mapper> 